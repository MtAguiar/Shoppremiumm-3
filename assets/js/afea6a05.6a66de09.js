(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{89:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return s}));var a=n(3),o=n(7),i=(n(0),n(96)),r={title:"Theme Bootstrap Process"},l={unversionedId:"theme-bootstrap",id:"theme-bootstrap",isDocsHomePage:!1,title:"Theme Bootstrap Process",description:"When using Nx-Shopify, the theme's CSS styles and JavaScript scripts are loaded automatically for you. You do not need to move a finger. However, is still important to understand how this process is done in case of needed modifications.",source:"@site/docs/theme-bootstrap.md",slug:"/theme-bootstrap",permalink:"/nx-shopify/docs/theme-bootstrap",editUrl:"https://github.com/trafilea/nx-shopify/edit/master/docs/docs/theme-bootstrap.md",version:"current",sidebar:"docs",previous:{title:"Theme Structure",permalink:"/nx-shopify/docs/theme-structure"},next:{title:"Layout Generator",permalink:"/nx-shopify/docs/generators/layout"}},c=[{value:"The main.ts file",id:"the-maints-file",children:[{value:"Webpack public path",id:"webpack-public-path",children:[]},{value:"themeBootstrap function",id:"themebootstrap-function",children:[]}]},{value:"Theme layouts &amp; templates Objects",id:"theme-layouts--templates-objects",children:[]},{value:"Calling the themeBootstrap function",id:"calling-the-themebootstrap-function",children:[]}],p={toc:c};function s(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"When using ",Object(i.b)("inlineCode",{parentName:"p"},"Nx-Shopify"),", the theme's CSS styles and JavaScript scripts are loaded automatically for you. You do not need to move a finger. However, is still important to understand how this process is done in case of needed modifications."),Object(i.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"If you want to follow this explanation step-by-step, it is recommended to generate a theme so you can read the code by your self \ud83d\ude42"),Object(i.b)("p",{parentName:"div"},Object(i.b)("inlineCode",{parentName:"p"},"nx g @trafilea/nx-shopify:theme my-theme")))),Object(i.b)("h2",{id:"the-maints-file"},"The main.ts file"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"main.ts")," file is the, well, main entrypoint of a ",Object(i.b)("inlineCode",{parentName:"p"},"Nx-Shopify")," theme. This is the very first code that is executed when a theme is loaded by a web browser."),Object(i.b)("p",null,"For a recently generated theme, the ",Object(i.b)("inlineCode",{parentName:"p"},"main.ts")," content should look something similar to this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="src/main.ts"',title:'"src/main.ts"'},"__webpack_public_path__ = window['__webpack_public_path__'];\n\nimport { themeBootstrapFactory } from '@my-org/my-theme/core/theme-bootstrap';\nimport { themeLayouts } from '@my-org/my-theme/theme/layout';\nimport { themeTemplates } from '@my-org/my-theme/theme/templates';\n\nwindow['themeBootstrap'] = themeBootstrapFactory(themeLayouts, themeTemplates);\n")),Object(i.b)("p",null,"This file fullfills two key responsabilities:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Make the webpack public path available to webpack."),Object(i.b)("li",{parentName:"ol"},"Define the global themeBootstrap function that will load the rest of our code.")),Object(i.b)("p",null,"Let's break this down..."),Object(i.b)("h3",{id:"webpack-public-path"},"Webpack public path"),Object(i.b)("p",null,"The top-level ",Object(i.b)("inlineCode",{parentName:"p"},"__webpack_public_path__")," variable is used to tell ",Object(i.b)("inlineCode",{parentName:"p"},"webpack"),", at run-time, what URL path it should look to download the rest of the chunks that will be loaded later (lazy loaded chunks)."),Object(i.b)("p",null,"As you may notice, this URL path comes from a window global variable called the same way. But, where does the value come from? The answer is that Nx-Shopify does this for you:"),Object(i.b)("p",null,"For every built theme, two special snippets are created:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-diff",metastring:"{16,17}","{16,17}":!0},"dist/apps/my-theme\n \u251c\u2500\u2500 assets\n \u2502   \u251c\u2500\u2500 (...)\n \u2502   \u2514\u2500\u2500 main.77d0b739d857080b2b1e.js\n \u251c\u2500\u2500 config\n \u2502   \u2514\u2500\u2500 (...)\n \u251c\u2500\u2500 config.yml\n \u251c\u2500\u2500 layout\n \u2502   \u2514\u2500\u2500 (...)\n \u251c\u2500\u2500 locales\n \u2502   \u2514\u2500\u2500 (...)\n \u251c\u2500\u2500 sections\n \u2502   \u2514\u2500\u2500 (...)\n \u251c\u2500\u2500 snippets\n \u2502   \u251c\u2500\u2500 (...)\n+\u2502   \u251c\u2500\u2500 script-tags.liquid\n+\u2502   \u2514\u2500\u2500 webpack-public-path.liquid\n \u2514\u2500\u2500 templates\n     \u2514\u2500\u2500 (...)\n")),Object(i.b)("h4",{id:"snippetsscript-tagsliquid"},Object(i.b)("inlineCode",{parentName:"h4"},"snippets/script-tags.liquid")),Object(i.b)("p",null,"This snippet renders the ",Object(i.b)("inlineCode",{parentName:"p"},"webpack-public-path")," snippet content and also adds the script tag that loads the ",Object(i.b)("inlineCode",{parentName:"p"},"main.ts")," entrypoint generated by webpack."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},'{% render \'webpack-public-path\' %}\n\n<script\n  type="text/javascript"\n  src="{{ \'main.77d0b739d857080b2b1e.js\' | asset_url }}"\n  defer="defer"\n><\/script>\n')),Object(i.b)("h4",{id:"snippetswebpack-public-pathliquid"},Object(i.b)("inlineCode",{parentName:"h4"},"snippets/webpack-public-path.liquid")),Object(i.b)("p",null,"This particular snippet executes a liquid code in charge of getting the base path of the Shopify's CDN url where the assets are located and assign it to the ",Object(i.b)("inlineCode",{parentName:"p"},"window.__webpack_public_path__")," global variable."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},"{% assign randomFile = 'randomFile.js' | asset_url %} {% assign cdnPath =\nrandomFile | split: 'assets/randomFile.js' | first %}\n<script>\n  window.__webpack_public_path__ = '{{ cdnPath }}';\n<\/script>\n")),Object(i.b)("p",null,"Once the above runs, webpack knows where to download the rest of our code chunks."),Object(i.b)("h3",{id:"themebootstrap-function"},"themeBootstrap function"),Object(i.b)("p",null,"As shown in the ",Object(i.b)("inlineCode",{parentName:"p"},"main.ts")," assignment, the ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrap")," function is created using a factory function inside the ",Object(i.b)("inlineCode",{parentName:"p"},"src/core")," directory called ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrapFactory"),"."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrapFactory")," function is a ",Object(i.b)("a",{parentName:"p",href:"https://www.freecodecamp.org/news/a-quick-intro-to-higher-order-functions-in-javascript-1a014f89c6b/"},"high order function")," that receives the theme ",Object(i.b)("inlineCode",{parentName:"p"},"registeredLayouts")," and ",Object(i.b)("inlineCode",{parentName:"p"},"registeredTemplates")," as arguments (see next section) and returns a function that takes a ",Object(i.b)("inlineCode",{parentName:"p"},"ShopifyBootstrapOptions")," object used to initialize the theme, which will be the ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrap")," function."),Object(i.b)("h2",{id:"theme-layouts--templates-objects"},"Theme layouts & templates Objects"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"registeredLayouts")," and ",Object(i.b)("inlineCode",{parentName:"p"},"registeredTemplates")," objects are reponsible of making the layout and templates TypeScript code available to the ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrap")," function."),Object(i.b)("p",null,"The composition of these objetcs are a key-value pairs. Each key corresponds to the name of the layout or template that will be loaded and the value is a function that uses webpack's dynamic import syntax to load the respective theme block, that function will be invoked by the ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrap")," function."),Object(i.b)("p",null,"Example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-typescript"},"const registeredTemplates = {\n  index: () => import('./index/index.template').then((m) => m.IndexTemplate),\n  blog: () => import('./blog/blog.template').then((m) => m.BlogTemplate),\n};\n")),Object(i.b)("p",null,"These objects are defined, by default, in the following files:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"src/theme/layout/theme-layouts.ts")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"src/theme/templates/theme-templates.ts"))),Object(i.b)("h2",{id:"calling-the-themebootstrap-function"},"Calling the themeBootstrap function"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrap")," global function defined in the ",Object(i.b)("inlineCode",{parentName:"p"},"src/main.ts")," file is wired to take care of the theme initialization as explained above. Now, when is this function called?"),Object(i.b)("p",null,"At the end of every layout liquid file, a script tag contains the JavaScript code that calls the ",Object(i.b)("inlineCode",{parentName:"p"},"themeBootstrap")," function."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html",metastring:"{6-13}","{6-13}":!0},"<html>\n  ...\n  <body>\n    ...\n    <script>\n      window.addEventListener('DOMContentLoaded', function() {\n        window.themeBootstrap({\n            themeLayoutName: 'theme',\n            themeTemplateName: '{{ template }}',\n            themeContext: {% render 'theme-context' %},\n            loadGlobal: true,\n        });\n      });\n    <\/script>\n  </body>\n</html>\n")),Object(i.b)("p",null,"Notice that the ",Object(i.b)("inlineCode",{parentName:"p"},"ShopifyBootstrapOptions")," argument is passed and it contains:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The layout name that should be loaded"),Object(i.b)("li",{parentName:"ul"},"The template name that should be loaded"),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"ThemeContext")," object (rendered by a snippet)"),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"loadGlobal")," flag")),Object(i.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"Learn more about the ",Object(i.b)("inlineCode",{parentName:"p"},"ThemeContext")," object at the ",Object(i.b)("a",{parentName:"p",href:"guides/liquid-to-ts-context"},"Liquid To TypeScript Context")," guide"))),Object(i.b)("p",null,"When the ",Object(i.b)("inlineCode",{parentName:"p"},"loadGlobal")," flag is set to true, the ",Object(i.b)("inlineCode",{parentName:"p"},"ThemeGlobalModule")," found in the ",Object(i.b)("inlineCode",{parentName:"p"},"./src/global")," will be loaded for any layout/template."))}s.isMDXComponent=!0},96:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=o.a.createContext({}),s=function(e){var t=o.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=s(e.components);return o.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=s(n),d=a,h=b["".concat(r,".").concat(d)]||b[d]||m[d]||i;return n?o.a.createElement(h,l(l({ref:t},p),{},{components:n})):o.a.createElement(h,l({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);